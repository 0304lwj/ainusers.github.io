<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!--添加自适应标签-->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" shrink-to-fit=no">
    <title>甜先森</title>
    <!--title上面添加icon-->
    <link rel="shortcut icon" href="../../../../images/head/head.png"/>
</head>

    <!--引入外部样式-->
    <link href="../../../../product/bootstrap/css/bootstrap.css" rel="stylesheet">
    <link href="../../../../css/quanzhan/linux/slide.css" rel="stylesheet">
    <!--jqueryui-->
    <link href="../../../../product/jqueryui/jquery-ui.min.css" rel="stylesheet">
    <link href="http://jqueryui.com/resources/demos/style.css" rel="stylesheet">

<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-2">
            <!--left-->
            <ul id="nav">
                <li>
                    <a href="#greenplum" style="text-transform: lowercase">搭建greenplum</a>
                    <ul>
                        <li class="current">
                            <a href="#hjzb">环境准备</a>
                        </li>
                        <li>
                            <a href="#azhj">安装环境</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
        <div class="col-md-10">
            <!--container-->
            <div id="container">
                <div class="section" id="hjzb">
                    <h2>环境准备</h2>
                    <pre class="prettyprint linenums">
                        <ol class="linenums">
1.greenplum安装包下载地址：https://network.pivotal.io/products/pivotal-gpdb/
                        </ol>
                    </pre>
                </div>
                <div class="section" id="azhj">
                    <h2>安装环境</h2>
                    <pre class="prettyprint linenums">
                        <ol class="linenums">
1.安装上传依赖
    yum install -y lrzsz
    rz -be  之后下载的安装包greenplum-db-5.3.0-rhel6-x86_64.zip上传至服务器目录
2.安装解压包命令
    yum install -y unzip
    unzip greenplum-db-5.3.0-rhel6-x86_64.zip
3.安装环境准备
    3.1关闭防火墙自启动
        chkconfig iptables off
        验证
        chkconfig --list|grep iptables
    3.2修改Linux内核参数
        vi /etc/sysctl.conf
            # Kernel sysctl configuration file for Red Hat Linux
            #
            # For binary values, 0 is disabled, 1 is enabled.  See sysctl(8) and
            # sysctl.conf(5) for more details.

            # Controls IP packet forwarding
            net.ipv4.ip_forward = 0

            # Controls source route verification
            net.ipv4.conf.default.rp_filter = 1

            # Do not accept source routing
            net.ipv4.conf.default.accept_source_route = 0

            # Controls the System Request debugging functionality of the kernel
            <strong style="color: red">kernel.sysrq = 1</strong>

            # Controls whether core dumps will append the PID to the core filename.
            # Useful for debugging multi-threaded applications.
            kernel.core_uses_pid = 1

            # Controls the use of TCP syncookies
            net.ipv4.tcp_syncookies = 1

            # Disable netfilter on bridges.
            net.bridge.bridge-nf-call-ip6tables = 0
            net.bridge.bridge-nf-call-iptables = 0
            net.bridge.bridge-nf-call-arptables = 0

            # Controls the default maxmimum size of a mesage queue
            kernel.msgmnb = 65536

            # Controls the maximum size of a message, in bytes
            <strong style="color: red">kernel.msgmax = 65536</strong>
            <strong style="color: red">kernel.msgmni = 2048</strong>
            <strong style="color: red">kernel.sem = 250 512000 100 2048</strong>

            # Controls the maximum shared segment size, in bytes
            # kernel.shmmax = 68719476736
            <strong style="color: red">kernel.shmmax = 500000000</strong>
            <strong style="color: red">kernel.shmmni = 4096</strong>

            # Controls the maximum number of shared memory segments, in pages
            # kernel.shmall = 4294967296
            <strong style="color: red">kernel.shmall = 4000000000</strong>

            <strong style="color: red"># 其他优化参数</strong>
            net.ipv4.tcp_tw_recycle=1
            net.ipv4.tcp_max_syn_backlog=4096
            net.ipv4.ip_local_port_range = 1025 65535
            net.core.netdev_max_backlog=10000
            vm.overcommit_memory=2
            net.ipv4.conf.all.arp_filter = 1
            net.core.rmem_max = 2097152
            net.core.wmem_max = 2097152
        配置文件生效命令
            sysctl -p
        如果报错net.bridge.bridge-nf-call-ip6tables" is an unknown key,请先执行命令：modprobe bridge
    3.3修改Linux最大限制
        注：系统的最大限制soft（软),hard(硬)，nofile 打开的最大文件数，nproc最大进程数，Soft的值不能超过hard
        vi /etc/security/limits.conf
            #
            # greenplum configs
            * soft nofile 65536
            * hard nofile 65536
            * soft nproc 131072
            * hard nproc 131072
            #
    3.4 I/O调整优化
        注：调整I/O调度算法，I/O调度器（elevator），相应的I/O调度算法有几种，比如as，cfq，deadline，noop；
            一般的数据库选择deadline调度算法。修改方法上面的为永久生效的修改方法，还有临时生效的动态修改方式：
            echo “deadline” > /sys/block/sda/queue/scheduler
        vi /boot/grub/menu.lst
            # greenplum configs
            elevator=deadline
    3.5设置selinux
        vi /etc/selinux/config
        SELINUX=disabled
    3.6修改主机名称
        vi /etc/sysconfig/network
        HOSTNAME=master
    3.7主机名映射IP
        vi /etc/hosts
        192.168.16.227 master
        192.168.16.228 slave1
        192.168.16.229 slave2
4.greenplum安装步骤
    4.1创建gpadmin用户
        useradd gpadmin
        passwd gpadmin
    4.2执行greenplum安装命令
        ./greenplum-db-5.3.0-rhel6-x86_64.bin
        一直按空格键，知道more信息结束
        yes
        回车
        yes
        yes
    4.3设置gpadmin用户环境
        cd /home/gpadmin
        .bashrc .bash_profile这两个文件均需要修改
        文件中添加最后两行配置信息
        source /usr/local/greenplum-db/greenplum_path.sh
        export MASTER_DATA_DIRECTORY=/data1/gpdata/master/gpseg-1
        source .bashrc
        source .bash_profile
    4.4准备节点服务器信息文件
        注：文件中为各个节点的主机名，该文件主要是用于批量操作，通过用户名进行识别各个主机，进行连接，批量操控
        mkdir /usr/local/greenplum-db/gpinit
        vi all_host
        master
        slave1
        slave2
    4.5建立节点服务器间的信任
        注：建立各节点直接的信任，使得各个几点之间可以连接，远程、批量操控；
        按照提示输入root密码，记住：这一步不能输入gpadmin的密码，因为批量安装时需要在/usr/local（安装路径）下创建目录，需要root权限
        用root用户操作命令之前，需要进行操作
        source /usr/local/greenplum-db/greenplum_path.sh  # 切换环境变量
        gpssh-exkeys -f /opt/gpinit/all_host
        ->输入slave1密码->输入slave2密码
    4.6批量安装
        注：将master上的greenplum打包通过scp命令传到all_host中的主机上，解压并赋予目录gpadmin的权限
        gpseginstall -f /usr/local/tools/gpinit/all_host -u gpadmin -p gpadmin
    4.7检查批量安装情况
        注：返回结果中各节点目录与master节点一致则成功
        gpssh -f /usr/local/tools/gpinit/all_host -e ls -l $GPHOME
    4.8创建存储目录
        master
            mkdir -p /usr/local/tools/gpdata/master
            chown gpadmin:gpadmin /usr/local/tools/gpdata/master
            scp -r  /usr/local/tools/gpinit @192.168.16.228:/usr/local/tools/
            scp -r  /usr/local/tools/gpinit @192.168.16.229:/usr/local/tools/
        slave1
            source /usr/local/greenplum-db/greenplum_path.sh
            gpssh -f /usr/local/tools/gpinit/all_host -e 'mkdir -p /usr/local/tools/gpdata/slave1'
            gpssh -f /usr/local/tools/gpinit/all_host -e 'chown -R gpadmin:gpadmin /usr/local/tools/gpdata/slave1'
        slave2
            source /usr/local/greenplum-db/greenplum_path.sh
            gpssh -f /usr/local/tools/gpinit/all_host -e 'mkdir -p /usr/local/tools/gpdata/slave2'
            gpssh -f /usr/local/tools/gpinit/all_host -e 'chown -R gpadmin:gpadmin /usr/local/tools/gpdata/slave2'
    4.9设置时钟同步
    5.0创建gp初始化文件
                        </ol>
                    </pre>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
    <!--jquery-->
    <script src="../../../../js/index/jquery-3.3.1.min.js"></script>
    <!--jquery.nav-->
    <script src="../../../../product/jqueryui/jquery.nav.js"></script>
    <!--jqueryui-->
    <script src="../../../../product/jqueryui/jquery-ui.min.js"></script>
<script>
    $( "#nav" ).accordion({
        collapsible: true
    });
    $(function(){
        $('#nav').onePageNav();
    });
</script>
</html>